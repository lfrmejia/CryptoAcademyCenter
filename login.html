<script>
  window.onload = async () => {
    const auth0 = await createAuth0Client({
      domain: "dev-v71b1kad1qrpea4h.us.auth0.com",
      client_id: "S1OgDqikNDLbbspTD6EViRlQsq19gTMz",
      redirect_uri: "https://lfrmejia.github.io/CryptoAcademyCenter/callback.html"
    });

    // Handle authentication result
    const query = window.location.search;
    if (query.includes("code=") && query.includes("state=")) {
      await auth0.handleRedirectCallback();
      window.history.replaceState({}, document.title, "/CryptoAcademyCenter/");
    }

    const isAuthenticated = await auth0.isAuthenticated();

    if (isAuthenticated) {
      document.getElementById("login").style.display = "none";
      document.getElementById("logout").style.display = "block";

      const user = await auth0.getUser();
      document.getElementById("profile").style.display = "block";
      document.getElementById("username").innerText = user.name;
      console.log("User Info:", user);
    }
  };

  // Log In function
  document.getElementById("login").addEventListener("click", async () => {
    await auth0.loginWithRedirect();
  });

  // Log Out function
  document.getElementById("logout").addEventListener("click", () => {
    auth0.logout({
      returnTo: "https://lfrmejia.github.io/CryptoAcademyCenter/"
    });
  });
</script>
